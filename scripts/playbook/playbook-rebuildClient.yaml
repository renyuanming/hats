---
- name: Rebuild the client
  hosts: cassandra_clients
  become: yes
  become_user: hats
  tasks:
    - name: Rebuild the client
      shell: . /etc/profile && cd PATH_TO_CLIENT && git checkout BRANCH_NAME && git pull origin BRANCH_NAME && mvn -pl cassandra -am clean package -U -Dcheckstyle.skip
      register: command_result
      ignore_errors: true
    - name: Fail the play if the previous command did not succeed
      fail: msg="the command failed"
      when: "'FAILED' in command_result.stderr"
